(()=>{var L=(u,s)=>()=>(s||u((s={exports:{}}).exports,s),s.exports);var q=L((T,m)=>{(function(u,s){typeof m=="object"&&typeof m.exports=="object"?m.exports=s():u.FormPrefill=s()})(typeof window<"u"?window:globalThis,function(){"use strict";const u={formSelector:'form[data-prefill="1"]',overwriteAttr:"data-prefill-overwrite",fieldSelector:"[data-prefill-key]",fieldKeyAttr:"data-prefill-key",queryPrefix:"af_",maxPayloadParamLength:12e3,maxDecodedPayloadBytes:16e3,maxKeysInPayload:50,maxVarsCount:50,fieldLimits:{name:80,email:120,subject:160,message:8e3},normalizeNewlines:!0,allowLiteralBackslashN:!0,fillOnlyIfEmpty:!0,debug:!1};function s(t){const e=Object.assign({},u,t||{});t&&t.fieldLimits&&(e.fieldLimits=Object.assign({},u.fieldLimits,t.fieldLimits)),e.queryPrefix=String(e.queryPrefix||""),e.queryPrefix&&!e.queryPrefix.endsWith("_")&&(e.queryPrefix+="_");const n=new URLSearchParams(window.location.search),r=P(n,e),l=document.querySelectorAll(e.formSelector);for(const i of l)g(i,n,r,e)}function g(t,e,n,r){const l=t.getAttribute(r.overwriteAttr)==="1",i=r.fillOnlyIfEmpty&&!l,o=Array.from(t.querySelectorAll(r.fieldSelector)),d=o.map(f=>f.getAttribute(r.fieldKeyAttr)).filter(f=>typeof f=="string"&&f.length>0),y=A(e,n?n.vars:null,d,r);for(const f of o){const c=f.getAttribute(r.fieldKeyAttr);if(!c||i&&String(f.value??"").trim()!=="")continue;let a=null;const b=r.queryPrefix+c;if(e.has(b)?a=e.get(b):n&&n.fields&&Object.prototype.hasOwnProperty.call(n.fields,c)&&(a=S(n.fields[c],y)),a==null)continue;a=p(a,r),r.allowLiteralBackslashN&&(a=a.replace(/\\n/g,`
`));const v=r.fieldLimits[c]??500;a=j(a,v),w(f,a,r)}}function w(t,e,n){const r=(t.tagName||"").toLowerCase(),l=t.getAttribute&&t.getAttribute("type")?String(t.getAttribute("type")).toLowerCase():"";if(!(l==="password"||l==="file")){if(r==="input"||r==="textarea"||r==="select"){t.value=e;return}n.debug&&console.warn("[FormPrefill] Unsupported element:",t)}}function P(t,e){const n=e.queryPrefix+"payload";if(!t.has(n))return null;const r=t.get(n)||"";if(r.length===0)return null;if(r.length>e.maxPayloadParamLength)return e.debug&&console.warn("[FormPrefill] payload param too long"),null;const l=h(r);if(!l)return e.debug&&console.warn("[FormPrefill] invalid base64url payload"),null;if(l.length>e.maxDecodedPayloadBytes)return e.debug&&console.warn("[FormPrefill] decoded payload too large"),null;const i=x(l);if(i===null)return e.debug&&console.warn("[FormPrefill] failed to decode UTF-8"),null;let o;try{o=JSON.parse(i)}catch{return e.debug&&console.warn("[FormPrefill] payload is not valid JSON"),null}if(!o||typeof o!="object")return null;const d=o.vars&&typeof o.vars=="object"&&!Array.isArray(o.vars)?o.vars:{},y=o.fields&&typeof o.fields=="object"&&!Array.isArray(o.fields)?o.fields:{};return Object.keys(d).length>e.maxVarsCount?(e.debug&&console.warn("[FormPrefill] too many vars in payload"),null):Object.keys(y).length>e.maxKeysInPayload?(e.debug&&console.warn("[FormPrefill] too many fields in payload"),null):{vars:d,fields:y}}function h(t){try{const e="=".repeat((4-t.length%4)%4),n=(t+e).replace(/-/g,"+").replace(/_/g,"/"),r=atob(n),l=new Uint8Array(r.length);for(let i=0;i<r.length;i++)l[i]=r.charCodeAt(i);return l}catch{return null}}function x(t){try{if(typeof TextDecoder<"u")return new TextDecoder("utf-8",{fatal:!1}).decode(t);let e="";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}catch{return null}}function A(t,e,n,r){const l={};if(e&&typeof e=="object")for(const[i,o]of Object.entries(e))l[String(i)]=p(o,r);for(const i of n){if(!i)continue;const o=r.queryPrefix+i;t.has(o)&&(l[i]=p(t.get(o),r))}return l}function S(t,e){return String(t??"").replace(/\{\{\s*([a-zA-Z0-9_.-]+)\s*\}\}/g,(n,r)=>{const l=e[r];return l==null?"":String(l)})}function p(t,e){let n=String(t??"");return e.normalizeNewlines&&(n=n.replace(/\r\n/g,`
`)),n.trim()}function j(t,e){return t=String(t??""),t.length>e?t.slice(0,e):t}return{init:s,version:"0.1.0"}})});q();})();
